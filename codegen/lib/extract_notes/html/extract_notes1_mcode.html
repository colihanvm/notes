<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="comment">% radius = 5.4;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">% num_find = 19;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% threshold = 155;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% im = imread('rowrowbt_mod3.png');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T201U3">notes</span>] = extract_notes(<span class="var type1" id="S3T1U6">im</span>, <span class="var type1" id="S4T2U7">threshold</span>, <span class="var type1" id="S5T2U8">num_find</span>, <span class="var type1" id="S6T2U9">radius</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="mxinfo " id="T15:U6"><span class="var type1" id="S3T15U12">im</span> = <span class="mxinfo " id="T15:U8">rgb2gray(<span class="var type1" id="S3T1U15">im</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S8T2U18">i</span>=<span class="mxinfo " id="T2:U11">1</span>:size(<span class="var type1" id="S3T15U23">im</span>,1)</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S10T2U27">j</span>=<span class="mxinfo " id="T2:U14">1</span>:size(<span class="var type1" id="S3T15U32">im</span>,2)</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T3:U16"><span class="mxinfo " id="T35:U17"><span class="var type1" id="S3T15U38">im</span>(<span class="var type1" id="S8T2U39">i</span>,<span class="var type1" id="S10T2U40">j</span>)</span> &gt; <span class="mxinfo " id="T2:U21">240</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line">            <span class="mxinfo " id="T35:U22"><span class="mxinfo " id="T35:U23"><span class="var type1" id="S3T15U45">im</span>(<span class="var type1" id="S8T2U46">i</span>,<span class="var type1" id="S10T2U47">j</span>)</span> = <span class="mxinfo " id="T2:U27">255</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="mxinfo " id="T16:U28"><span class="var type1" id="S11T16U51">double_im</span> = <span class="mxinfo " id="T16:U30">double(<span class="var type1" id="S3T15U54">im</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="mxinfo " id="T21:U32"><span class="var type1" id="S13T21U57">tmp</span> = <span class="mxinfo " id="T21:U34">sum(<span class="var type1" id="S11T16U60">double_im</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="mxinfo " id="T2:U36"><span class="var type1" id="S15T2U64">mean_val</span> = <span class="mxinfo " id="T2:U38"><span class="mxinfo " id="T2:U39">sum(<span class="var type1" id="S13T21U68">tmp</span>)</span>/<span class="mxinfo " id="T2:U41">size(<span class="var type1" id="S13T21U71">tmp</span>,1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="mxinfo " id="T2:U43"><span class="var type1" id="S16T2U75">std_val</span> = <span class="mxinfo " id="T2:U45">std(<span class="var type1" id="S13T21U78">tmp</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="mxinfo " id="T2:U47"><span class="var type1" id="S18T2U81">threshold_val</span> = <span class="mxinfo " id="T2:U49"><span class="var type1" id="S15T2U83">mean_val</span> - <span class="mxinfo " id="T2:U51"><span class="mxinfo " id="T2:U52">2</span> * <span class="var type1" id="S16T2U86">std_val</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo " id="T202:U54"><span class="var type1" id="S19T202U89">ind</span> = <span class="mxinfo " id="T202:U56">find(<span class="mxinfo " id="T25:U57"><span class="var type1" id="S13T21U93">tmp</span> &lt; <span class="var type1" id="S18T2U94">threshold_val</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%actually delete the staffs</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo " id="T203:U60"><span class="mxinfo " id="T203:U61"><span class="var type1" id="S3T15U98">im</span>(<span class="var type1" id="S19T202U99">ind</span>, <span class="mxinfo " id="T210:U64">:</span>)</span> = <span class="mxinfo " id="T2:U65">255</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%calculate staff lines</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo " id="T33:U66"><span class="var type1" id="S21T33U104">staffs</span> = <span class="mxinfo " id="T33:U68">zeros(10,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="mxinfo " id="T2:U69"><span class="mxinfo " id="T2:U70"><span class="var type1" id="S21T33U112">staffs</span>(1)</span> = <span class="mxinfo " id="T2:U72"><span class="var type1" id="S19T202U115">ind</span>(<span class="mxinfo " id="T2:U74">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo " id="T202:U75"><span class="var type1" id="S23T202U119">lines</span> = <span class="mxinfo " id="T202:U77">zeros(<span class="mxinfo " id="T11:U78">size(<span class="var type1" id="S19T202U124">ind</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="mxinfo " id="T2:U80"><span class="var type1" id="S10T2U127">j</span> = <span class="mxinfo " id="T2:U82">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="mxinfo " id="T2:U83"><span class="var type1" id="S24T2U131">num</span> = <span class="mxinfo " id="T2:U85">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"><span class="mxinfo " id="T2:U86"><span class="mxinfo " id="T2:U87"><span class="var type1" id="S23T202U136">lines</span>(<span class="mxinfo " id="T2:U89">1</span>)</span> = <span class="mxinfo " id="T2:U90">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo " id="T33:U91"><span class="var type1" id="S25T33U141">staff_num</span> = <span class="mxinfo " id="T33:U93">zeros(size(<span class="var type1" id="S21T33U146">staffs</span>))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"><span class="mxinfo " id="T2:U95"><span class="mxinfo " id="T2:U96"><span class="var type1" id="S25T33U150">staff_num</span>(<span class="mxinfo " id="T2:U98">1</span>)</span> = <span class="mxinfo " id="T2:U99">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S8T2U155">i</span>=<span class="mxinfo " id="T2:U101">2</span>:<span class="mxinfo " id="T2:U102">size(<span class="var type1" id="S19T202U160">ind</span>,1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo " id="T3:U104"><span class="mxinfo " id="T2:U105"><span class="var type1" id="S19T202U167">ind</span>(<span class="var type1" id="S8T2U168">i</span>)</span> &gt; (<span class="mxinfo " id="T2:U108"><span class="mxinfo " id="T2:U109"><span class="var type1" id="S19T202U172">ind</span>(<span class="mxinfo " id="T2:U111"><span class="var type1" id="S8T2U174">i</span>-<span class="mxinfo " id="T2:U113">1</span></span>)</span> + <span class="mxinfo " id="T2:U114">1</span></span>)</span>) <span class="comment">%end line deletion</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line">        <span class="mxinfo " id="T2:U115"><span class="mxinfo " id="T2:U116"><span class="var type1" id="S21T33U180">staffs</span>(<span class="var type1" id="S10T2U181">j</span>)</span> = <span class="mxinfo " id="T2:U119">floor(<span class="mxinfo " id="T2:U120"><span class="mxinfo " id="T2:U121"><span class="var type1" id="S21T33U186">staffs</span>(<span class="var type1" id="S10T2U187">j</span>)</span> / <span class="var type1" id="S24T2U188">num</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line">        <span class="mxinfo " id="T2:U125"><span class="var type1" id="S24T2U191">num</span> = <span class="mxinfo " id="T2:U127">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line">        <span class="mxinfo " id="T2:U128"><span class="var type1" id="S10T2U195">j</span> = <span class="mxinfo " id="T2:U130"><span class="var type1" id="S10T2U197">j</span> + <span class="mxinfo " id="T2:U132">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line">        <span class="mxinfo " id="T2:U133"><span class="mxinfo " id="T2:U134"><span class="var type1" id="S21T33U202">staffs</span>(<span class="var type1" id="S10T2U203">j</span>)</span> = <span class="mxinfo " id="T2:U137"><span class="var type1" id="S19T202U205">ind</span>(<span class="var type1" id="S8T2U206">i</span>)</span></span>; <span class="comment">%first line</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line">        <span class="mxinfo " id="T2:U140"><span class="mxinfo " id="T2:U141"><span class="var type1" id="S23T202U210">lines</span>(<span class="var type1" id="S8T2U211">i</span>)</span> = <span class="var type1" id="S10T2U212">j</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line">        <span class="mxinfo " id="T2:U145"><span class="mxinfo " id="T2:U146"><span class="var type1" id="S25T33U216">staff_num</span>(<span class="var type1" id="S10T2U217">j</span>)</span> = <span class="mxinfo " id="T2:U149"><span class="mxinfo " id="T2:U150"><span class="var type1" id="S25T33U220">staff_num</span>(<span class="var type1" id="S10T2U221">j</span>)</span> + <span class="mxinfo " id="T2:U153">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line">        <span class="mxinfo " id="T2:U154"><span class="mxinfo " id="T2:U155"><span class="var type1" id="S21T33U227">staffs</span>(<span class="var type1" id="S10T2U228">j</span>)</span> = <span class="mxinfo " id="T2:U158"><span class="mxinfo " id="T2:U159"><span class="var type1" id="S21T33U231">staffs</span>(<span class="var type1" id="S10T2U232">j</span>)</span> + <span class="mxinfo " id="T2:U162"><span class="var type1" id="S19T202U234">ind</span>(<span class="var type1" id="S8T2U235">i</span>)</span></span></span>; <span class="comment">%there was a line deleted above this</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line">        <span class="mxinfo " id="T2:U165"><span class="mxinfo " id="T2:U166"><span class="var type1" id="S23T202U239">lines</span>(<span class="var type1" id="S8T2U240">i</span>)</span> = <span class="var type1" id="S10T2U241">j</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line">        <span class="mxinfo " id="T2:U170"><span class="mxinfo " id="T2:U171"><span class="var type1" id="S25T33U245">staff_num</span>(<span class="var type1" id="S10T2U246">j</span>)</span> = <span class="mxinfo " id="T2:U174"><span class="mxinfo " id="T2:U175"><span class="var type1" id="S25T33U249">staff_num</span>(<span class="var type1" id="S10T2U250">j</span>)</span> + <span class="mxinfo " id="T2:U178">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line">        <span class="mxinfo " id="T2:U179"><span class="var type1" id="S24T2U254">num</span> = <span class="mxinfo " id="T2:U181"><span class="var type1" id="S24T2U256">num</span> + <span class="mxinfo " id="T2:U183">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T3:U184"><span class="var type1" id="S8T2U261">i</span> == <span class="mxinfo " id="T2:U186">size(<span class="var type1" id="S19T202U264">ind</span>,1)</span></span> <span class="comment">%last</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line">            <span class="mxinfo " id="T2:U188"><span class="mxinfo " id="T2:U189"><span class="var type1" id="S21T33U269">staffs</span>(<span class="var type1" id="S10T2U270">j</span>)</span> = <span class="mxinfo " id="T2:U192">floor(<span class="mxinfo " id="T2:U193"><span class="mxinfo " id="T2:U194"><span class="var type1" id="S21T33U275">staffs</span>(<span class="var type1" id="S10T2U276">j</span>)</span> / <span class="var type1" id="S24T2U277">num</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%GAP STITCHING:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%lines array contains index of staffs that were removed, matches ind array</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%staff_num tells number of horiz lines deleted around this staff</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="mxinfo " id="T34:U198"><span class="var type1" id="S27T34U280">all_notes</span> = <span class="mxinfo " id="T34:U200"><span class="var type1" id="S3T15U282">im</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"><span class="mxinfo " id="T2:U202"><span class="var type1" id="S28T2U286">note_threshold</span> = <span class="mxinfo " id="T2:U204"><span class="mxinfo " id="T2:U205">floor(<span class="mxinfo " id="T2:U206"><span class="mxinfo " id="T2:U207">sum(<span class="var type1" id="S27T34U293">all_notes</span>)</span>/(<span class="mxinfo " id="T2:U209">size(<span class="var type1" id="S27T34U297">all_notes</span>,1)</span>)</span>)</span> - <span class="mxinfo " id="T2:U211"><span class="mxinfo " id="T2:U212">2</span> * <span class="mxinfo " id="T2:U213">std(<span class="mxinfo " id="T36:U214">double(<span class="var type1" id="S27T34U305">all_notes</span>)</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="mxinfo " id="T2:U216"><span class="var type1" id="S29T2U308">lines_passed</span> = <span class="mxinfo " id="T2:U218">1</span></span>; <span class="comment">%will give current index of ind array (y pos of all staff part lines detected)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"><span class="mxinfo " id="T37:U219"><span class="var type1" id="S30T37U312">staff_heights</span> = <span class="mxinfo " id="T37:U221">zeros(<span class="mxinfo " id="T2:U222">size(<span class="var type1" id="S21T33U318">staffs</span>,1) - size(<span class="var type1" id="S21T33U323">staffs</span>,1)/5</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"><span class="mxinfo " id="T2:U225"><span class="var type1" id="S31T2U329">h</span> = <span class="mxinfo " id="T2:U227">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S32T2U333">s</span>=<span class="mxinfo " id="T2:U229">1</span>:size(<span class="var type1" id="S21T33U338">staffs</span>,1) <span class="comment">%y values of staffs. s = index of staffs AKA staff number</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">    <span class="mxinfo " id="T2:U231"><span class="var type1" id="S33T2U342">above_s</span> = <span class="mxinfo " id="T2:U233"><span class="mxinfo " id="T2:U234"><span class="var type1" id="S19T202U345">ind</span>(<span class="var type1" id="S29T2U346">lines_passed</span>)</span>-<span class="mxinfo " id="T2:U237">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">    <span class="mxinfo " id="T2:U238"><span class="var type1" id="S34T2U350">below_s</span> = <span class="mxinfo " id="T2:U240"><span class="mxinfo " id="T2:U241"><span class="var type1" id="S19T202U353">ind</span>(<span class="var type1" id="S29T2U354">lines_passed</span>)</span> + <span class="mxinfo " id="T2:U244"><span class="var type1" id="S25T33U356">staff_num</span>(<span class="var type1" id="S32T2U357">s</span>)</span></span></span>; <span class="comment">%ind(lines_passed) + staff_num(s)-1 + 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S35T2U360">x</span>=<span class="mxinfo " id="T2:U248">1</span>:size(<span class="var type1" id="S3T15U365">im</span>,2) <span class="comment">%x pos of image</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo " id="T3:U250"><span class="mxinfo " id="T35:U251"><span class="var type1" id="S3T15U372">im</span>(<span class="var type1" id="S33T2U373">above_s</span>, <span class="var type1" id="S35T2U374">x</span>)</span> &lt; <span class="var type1" id="S28T2U375">note_threshold</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line">            <span class="keyword">if</span>(<span class="mxinfo " id="T3:U256"><span class="mxinfo " id="T35:U257"><span class="var type1" id="S3T15U381">im</span>(<span class="var type1" id="S34T2U382">below_s</span>, <span class="var type1" id="S35T2U383">x</span>)</span> &lt; <span class="var type1" id="S28T2U384">note_threshold</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">                <span class="mxinfo " id="T211:U262"><span class="mxinfo " id="T211:U263"><span class="var type1" id="S3T15U388">im</span>(<span class="mxinfo " id="T212:U265"><span class="mxinfo " id="T2:U266"><span class="var type1" id="S19T202U391">ind</span>(<span class="var type1" id="S29T2U392">lines_passed</span>)</span>:(<span class="mxinfo " id="T2:U269"><span class="var type1" id="S19T202U395">ind</span>(<span class="mxinfo " id="T2:U271"><span class="mxinfo " id="T2:U272"><span class="var type1" id="S29T2U398">lines_passed</span> + <span class="mxinfo " id="T2:U274"><span class="var type1" id="S25T33U400">staff_num</span>(<span class="var type1" id="S32T2U401">s</span>)</span></span> - <span class="mxinfo " id="T2:U277">1</span></span>)</span>)</span>, <span class="var type1" id="S35T2U403">x</span>)</span> = <span class="mxinfo " id="T35:U279">floor(<span class="mxinfo " id="T35:U280">(<span class="mxinfo " id="T35:U281"><span class="mxinfo " id="T35:U282"><span class="var type1" id="S3T15U410">im</span>(<span class="var type1" id="S33T2U411">above_s</span>, <span class="var type1" id="S35T2U412">x</span>)</span> + <span class="mxinfo " id="T35:U286"><span class="var type1" id="S3T15U414">im</span>(<span class="var type1" id="S34T2U415">below_s</span>, <span class="var type1" id="S35T2U416">x</span>)</span></span>)/<span class="mxinfo " id="T2:U290">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">            <span class="keyword">elseif</span> (<span class="mxinfo " id="T3:U291"><span class="mxinfo " id="T35:U292"><span class="var type1" id="S3T15U422">im</span>(<span class="var type1" id="S33T2U423">above_s</span>, <span class="var type1" id="S35T2U424">x</span>)</span> &lt; <span class="var type1" id="S28T2U425">note_threshold</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">                <span class="mxinfo " id="T211:U297"><span class="mxinfo " id="T211:U298"><span class="var type1" id="S3T15U429">im</span>(<span class="mxinfo " id="T212:U300"><span class="mxinfo " id="T2:U301"><span class="var type1" id="S19T202U432">ind</span>(<span class="var type1" id="S29T2U433">lines_passed</span>)</span>:(<span class="mxinfo " id="T2:U304"><span class="var type1" id="S19T202U436">ind</span>(<span class="mxinfo " id="T2:U306"><span class="mxinfo " id="T2:U307"><span class="var type1" id="S29T2U439">lines_passed</span> + <span class="mxinfo " id="T2:U309"><span class="var type1" id="S25T33U441">staff_num</span>(<span class="var type1" id="S32T2U442">s</span>)</span></span> - <span class="mxinfo " id="T2:U312">1</span></span>)</span>)</span>, <span class="var type1" id="S35T2U444">x</span>)</span> = <span class="mxinfo " id="T35:U314">floor(<span class="mxinfo " id="T35:U315">(<span class="mxinfo " id="T35:U316"><span class="var type1" id="S3T15U450">im</span>(<span class="var type1" id="S33T2U451">above_s</span>, <span class="var type1" id="S35T2U452">x</span>)</span>)/<span class="mxinfo " id="T2:U320">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">        <span class="keyword">elseif</span>(<span class="mxinfo " id="T3:U321"><span class="mxinfo " id="T35:U322"><span class="var type1" id="S3T15U458">im</span>(<span class="var type1" id="S34T2U459">below_s</span>, <span class="var type1" id="S35T2U460">x</span>)</span> &lt; <span class="var type1" id="S28T2U461">note_threshold</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">            <span class="mxinfo " id="T211:U327"><span class="mxinfo " id="T211:U328"><span class="var type1" id="S3T15U465">im</span>(<span class="mxinfo " id="T212:U330"><span class="mxinfo " id="T2:U331"><span class="var type1" id="S19T202U468">ind</span>(<span class="var type1" id="S29T2U469">lines_passed</span>)</span>:(<span class="mxinfo " id="T2:U334"><span class="var type1" id="S19T202U472">ind</span>(<span class="mxinfo " id="T2:U336"><span class="mxinfo " id="T2:U337"><span class="var type1" id="S29T2U475">lines_passed</span> + <span class="mxinfo " id="T2:U339"><span class="var type1" id="S25T33U477">staff_num</span>(<span class="var type1" id="S32T2U478">s</span>)</span></span> - <span class="mxinfo " id="T2:U342">1</span></span>)</span>)</span>, <span class="var type1" id="S35T2U480">x</span>)</span> = <span class="mxinfo " id="T35:U344">floor(<span class="mxinfo " id="T35:U345">(<span class="mxinfo " id="T35:U346"><span class="var type1" id="S3T15U486">im</span>(<span class="var type1" id="S34T2U487">below_s</span>, <span class="var type1" id="S35T2U488">x</span>)</span>)/<span class="mxinfo " id="T2:U350">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">    <span class="mxinfo " id="T2:U351"><span class="var type1" id="S29T2U492">lines_passed</span> = <span class="mxinfo " id="T2:U353"><span class="var type1" id="S29T2U494">lines_passed</span> + <span class="mxinfo " id="T2:U355"><span class="var type1" id="S25T33U496">staff_num</span>(<span class="var type1" id="S32T2U497">s</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo " id="T3:U358"><span class="var type1" id="S32T2U502">s</span>&gt;<span class="mxinfo " id="T2:U360">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo " id="T3:U361"><span class="mxinfo " id="T2:U362">mod(<span class="var type1" id="S32T2U510">s</span>,<span class="mxinfo " id="T2:U364">6</span>)</span> ~= <span class="mxinfo " id="T2:U365">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">            <span class="mxinfo " id="T2:U366"><span class="mxinfo " id="T2:U367"><span class="var type1" id="S30T37U516">staff_heights</span>(<span class="var type1" id="S31T2U517">h</span>)</span> = <span class="mxinfo " id="T2:U370"><span class="mxinfo " id="T2:U371"><span class="var type1" id="S21T33U520">staffs</span>(<span class="var type1" id="S32T2U521">s</span>)</span> - <span class="mxinfo " id="T2:U374"><span class="var type1" id="S21T33U523">staffs</span>(<span class="mxinfo " id="T2:U376"><span class="var type1" id="S32T2U525">s</span>-<span class="mxinfo " id="T2:U378">1</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">            <span class="mxinfo " id="T2:U379"><span class="var type1" id="S31T2U529">h</span> = <span class="mxinfo " id="T2:U381"><span class="var type1" id="S31T2U531">h</span> + <span class="mxinfo " id="T2:U383">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"><span class="mxinfo " id="T2:U384"><span class="var type1" id="S37T2U535">avg_staff_height</span> = <span class="mxinfo " id="T2:U386"><span class="mxinfo " id="T2:U387">sum(<span class="var type1" id="S30T37U539">staff_heights</span>)</span>/<span class="mxinfo " id="T2:U389">size(<span class="var type1" id="S30T37U542">staff_heights</span>,1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"><span class="comment">%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"><span class="comment">%do work by chunks in this section</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line"><span class="comment">% radius = 5.4;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line"><span class="comment">% num = 19; </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line"><span class="mxinfo " id="T2:U391"><span class="var type1" id="S38T2U546">acc</span> = <span class="mxinfo " id="T2:U393">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%% TO DO: preallocate centers array </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line"><span class="mxinfo " id="T194:U394"><span class="message warning" id="M1F1C"><span class="var type1" id="S39T194U550">centers</span> = []</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line"><span class="comment">%remove vertical lines by stanza, using process_stanza() function.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line"><span class="mxinfo " id="T2:U396"><span class="var type1" id="S40T2U555">num_stanza</span> = <span class="mxinfo " id="T2:U398">size(<span class="var type1" id="S21T33U559">staffs</span>,1)/5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S41T2U564">stanza</span>=<span class="mxinfo " id="T2:U401">1</span>:<span class="var type1" id="S40T2U567">num_stanza</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">    <span class="mxinfo " id="T15:U403"><span class="var type1" id="S42T15U570">blank</span> = <span class="mxinfo " id="T15:U405">uint8(<span class="mxinfo " id="T16:U406"><span class="mxinfo " id="T2:U407">255</span> * <span class="mxinfo " id="T16:U408">ones(size(<span class="var type1" id="S3T15U579">im</span>))</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line">    <span class="mxinfo " id="T2:U410"><span class="var type1" id="S45T2U582">chunk_start</span> = <span class="mxinfo " id="T2:U412"><span class="var type1" id="S21T33U584">staffs</span>(<span class="mxinfo " id="T2:U414"><span class="mxinfo " id="T2:U415">1</span> + <span class="mxinfo " id="T2:U416">(<span class="mxinfo " id="T2:U417"><span class="var type1" id="S41T2U590">stanza</span> - <span class="mxinfo " id="T2:U419">1</span></span>) * <span class="mxinfo " id="T2:U420">5</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line">    <span class="mxinfo " id="T2:U421"><span class="var type1" id="S46T2U595">chunk_end</span> = <span class="mxinfo " id="T2:U423"><span class="mxinfo " id="T2:U424"><span class="var type1" id="S21T33U598">staffs</span>(<span class="mxinfo " id="T2:U426"><span class="mxinfo " id="T2:U427">5</span> + <span class="mxinfo " id="T2:U428">(<span class="mxinfo " id="T2:U429"><span class="var type1" id="S41T2U604">stanza</span> - <span class="mxinfo " id="T2:U431">1</span></span>) * <span class="mxinfo " id="T2:U432">5</span></span></span>)</span> + <span class="mxinfo " id="T2:U433"><span class="mxinfo " id="T2:U434">2</span> * <span class="var type1" id="S37T2U609">avg_staff_height</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line">    <span class="mxinfo " id="T203:U436"><span class="var type1" id="S47T203U612">im_chunk</span> = <span class="mxinfo " id="T203:U438"><span class="var type1" id="S3T15U614">im</span>(<span class="mxinfo " id="T212:U440"><span class="var type1" id="S45T2U616">chunk_start</span>:<span class="var type1" id="S46T2U617">chunk_end</span></span>, <span class="mxinfo " id="T210:U443">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line">    <span class="mxinfo " id="T203:U444"><span class="var type1" id="S47T203U621">im_chunk</span> = <span class="mxinfo " id="T203:U446"><span class="fcn" id="F247N9:B623">process_stanza</span>(<span class="var type1" id="S47T203U624">im_chunk</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line">    <span class="mxinfo " id="T203:U448"><span class="mxinfo " id="T203:U449"><span class="var type1" id="S42T15U628">blank</span>(<span class="mxinfo " id="T212:U451"><span class="var type1" id="S45T2U630">chunk_start</span>:<span class="var type1" id="S46T2U631">chunk_end</span></span>, <span class="mxinfo " id="T210:U454">:</span>)</span> = <span class="var type1" id="S47T203U633">im_chunk</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line">    <span class="mxinfo " id="T204:U456"><span class="var type1" id="S49T204U636">edges</span> = <span class="mxinfo " id="T204:U458"><span class="fcn" id="F674N3:B638">detectEdges_removeLines</span>(<span class="var type1" id="S42T15U639">blank</span>, <span class="var type1" id="S4T2U640">threshold</span>, 0)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">    <span class="mxinfo " id="T194:U461"><span class="var type1" id="S51T194U644">chunk_centers</span> = <span class="mxinfo " id="T194:U463"><span class="fcn" id="F721N2:B646">detectCircles</span>(<span class="var type1" id="S42T15U647">blank</span>, <span class="var type1" id="S49T204U648">edges</span>, <span class="var type1" id="S6T2U649">radius</span>, <span class="var type1" id="S5T2U650">num_find</span>, <span class="var type1" id="S38T2U651">acc</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line">    <span class="comment">%sort by x</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line">    [<span class="mxinfo " id="T2:U469"><span class="mxinfo " id="T32:U470">~</span></span>, <span class="mxinfo " id="T32:U471"><span class="var type1" id="S53T32U656">sort_ind</span></span>] = sort(<span class="mxinfo " id="T32:U473"><span class="var type1" id="S51T194U660">chunk_centers</span>(<span class="mxinfo " id="T27:U475">:</span>,<span class="mxinfo " id="T6:U476">1</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line">    <span class="mxinfo " id="T194:U477"><span class="var type1" id="S51T194U665">chunk_centers</span> = <span class="mxinfo " id="T194:U479"><span class="var type1" id="S51T194U667">chunk_centers</span> (<span class="var type1" id="S53T32U668">sort_ind</span>,<span class="mxinfo " id="T213:U482">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line">    <span class="comment">%post processing of this chunk</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">    <span class="comment">%first, remove the random perimeter circles that tend to pop up</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">    <span class="mxinfo " id="T194:U483"><span class="var type1" id="S51T194U673">chunk_centers</span>(<span class="mxinfo " id="T31:U485"><span class="mxinfo " id="T32:U486"><span class="var type1" id="S51T194U676">chunk_centers</span>(<span class="mxinfo " id="T27:U488">:</span>,<span class="mxinfo " id="T6:U489">1</span>)</span> &gt; <span class="mxinfo " id="T2:U490"><span class="mxinfo " id="T2:U491">size(<span class="var type1" id="S3T15U682">im</span>,2)</span> - <span class="var type1" id="S6T2U684">radius</span></span></span>, :) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line">    <span class="mxinfo " id="T194:U494"><span class="var type1" id="S51T194U691">chunk_centers</span>(<span class="mxinfo " id="T31:U496"><span class="mxinfo " id="T32:U497"><span class="var type1" id="S51T194U694">chunk_centers</span>(<span class="mxinfo " id="T27:U499">:</span>,<span class="mxinfo " id="T6:U500">2</span>)</span> &gt; <span class="mxinfo " id="T2:U501"><span class="mxinfo " id="T2:U502">size(<span class="var type1" id="S3T15U700">im</span>,1)</span> - <span class="var type1" id="S6T2U702">radius</span></span></span>, :) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line">    <span class="mxinfo " id="T31:U505"><span class="var type1" id="S55T31U708">extras</span> = <span class="mxinfo " id="T31:U507"><span class="mxinfo " id="T3:U508">false</span>(<span class="mxinfo " id="T2:U509">size(<span class="var type1" id="S51T194U713">chunk_centers</span>,1)</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line">    <span class="comment">%check every circle c:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S57T2U718">c</span>=<span class="mxinfo " id="T2:U512">2</span>:<span class="mxinfo " id="T2:U513">size(<span class="var type1" id="S51T194U723">chunk_centers</span>,1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo " id="T3:U515"><span class="mxinfo " id="T2:U516"><span class="var type1" id="S51T194U730">chunk_centers</span>(<span class="var type1" id="S57T2U731">c</span>,<span class="mxinfo " id="T6:U519">1</span>)</span> == <span class="mxinfo " id="T2:U520"><span class="var type1" id="S51T194U734">chunk_centers</span>(<span class="mxinfo " id="T2:U522"><span class="var type1" id="S57T2U736">c</span>-<span class="mxinfo " id="T2:U524">1</span></span>,<span class="mxinfo " id="T2:U525">1</span>)</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">            <span class="mxinfo " id="T3:U526"><span class="mxinfo " id="T3:U527"><span class="var type1" id="S55T31U742">extras</span>(<span class="var type1" id="S57T2U743">c</span>)</span> = <span class="mxinfo " id="T2:U530">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">        <span class="keyword">elseif</span> (<span class="mxinfo " id="T3:U531"><span class="mxinfo " id="T2:U532">abs(<span class="mxinfo " id="T2:U533"><span class="mxinfo " id="T2:U534"><span class="var type1" id="S51T194U752">chunk_centers</span>(<span class="var type1" id="S57T2U753">c</span>,<span class="mxinfo " id="T6:U537">1</span>)</span> - <span class="mxinfo " id="T2:U538"><span class="var type1" id="S51T194U756">chunk_centers</span>(<span class="mxinfo " id="T2:U540"><span class="var type1" id="S57T2U758">c</span>-<span class="mxinfo " id="T2:U542">1</span></span>,<span class="mxinfo " id="T2:U543">1</span>)</span></span>)</span> &lt; <span class="mxinfo " id="T2:U544"><span class="var type1" id="S6T2U762">radius</span>*<span class="mxinfo " id="T2:U546">2</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line">            <span class="keyword">if</span> (<span class="mxinfo " id="T3:U547"><span class="mxinfo " id="T2:U548"><span class="var type1" id="S53T32U769">sort_ind</span>(<span class="var type1" id="S57T2U770">c</span>)</span> &lt; <span class="mxinfo " id="T2:U551"><span class="var type1" id="S53T32U772">sort_ind</span>(<span class="mxinfo " id="T2:U553"><span class="var type1" id="S57T2U774">c</span>-<span class="mxinfo " id="T2:U555">1</span></span>)</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">                <span class="mxinfo " id="T3:U556"><span class="mxinfo " id="T3:U557"><span class="var type1" id="S55T31U779">extras</span>(<span class="mxinfo " id="T2:U559"><span class="var type1" id="S57T2U781">c</span>-<span class="mxinfo " id="T2:U561">1</span></span>)</span> = <span class="mxinfo " id="T2:U562">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">                <span class="mxinfo " id="T3:U563"><span class="mxinfo " id="T3:U564"><span class="var type1" id="S55T31U788">extras</span>(<span class="var type1" id="S57T2U789">c</span>)</span> = <span class="mxinfo " id="T2:U567">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line">    <span class="comment">%remove the circles we just flagged</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line">    <span class="mxinfo " id="T194:U568"><span class="var type1" id="S51T194U794">chunk_centers</span>(<span class="var type1" id="S55T31U795">extras</span>,:) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line">    <span class="comment">%final post processing for individual circles</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line">    <span class="comment">%TODO: better benchmarks</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S57T2U801">c</span>=<span class="mxinfo " id="T2:U572">1</span>:<span class="mxinfo " id="T2:U573">size(<span class="var type1" id="S51T194U806">chunk_centers</span>,1)</span>         </span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line">        <span class="mxinfo " id="T2:U575"><span class="var type1" id="S59T2U810">top</span> = <span class="mxinfo " id="T2:U577">sum(<span class="mxinfo " id="T211:U578"><span class="var type1" id="S42T15U814">blank</span>(<span class="mxinfo " id="T212:U580"><span class="mxinfo " id="T2:U581"><span class="mxinfo " id="T2:U582"><span class="var type1" id="S51T194U818">chunk_centers</span>(<span class="var type1" id="S57T2U819">c</span>,<span class="mxinfo " id="T6:U585">2</span>)</span>-<span class="mxinfo " id="T2:U586">floor(<span class="var type1" id="S6T2U823">radius</span>)</span></span>:<span class="mxinfo " id="T2:U588"><span class="var type1" id="S51T194U825">chunk_centers</span>(<span class="var type1" id="S57T2U826">c</span>,<span class="mxinfo " id="T6:U591">2</span>)</span></span>,<span class="mxinfo " id="T2:U592"><span class="var type1" id="S51T194U829">chunk_centers</span>(<span class="var type1" id="S57T2U830">c</span>,<span class="mxinfo " id="T6:U595">1</span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line">        <span class="mxinfo " id="T2:U596"><span class="var type1" id="S60T2U834">bottom</span> = <span class="mxinfo " id="T2:U598">sum(<span class="mxinfo " id="T196:U599"><span class="var type1" id="S42T15U838">blank</span>(<span class="mxinfo " id="T32:U601"><span class="mxinfo " id="T2:U602"><span class="var type1" id="S51T194U841">chunk_centers</span>(<span class="var type1" id="S57T2U842">c</span>,<span class="mxinfo " id="T6:U605">2</span>)</span>:<span class="mxinfo " id="T2:U606"><span class="mxinfo " id="T2:U607"><span class="var type1" id="S51T194U846">chunk_centers</span>(<span class="var type1" id="S57T2U847">c</span>,<span class="mxinfo " id="T6:U610">2</span>)</span>+<span class="mxinfo " id="T2:U611">floor(<span class="var type1" id="S6T2U851">radius</span>)</span></span></span>,<span class="mxinfo " id="T2:U613"><span class="var type1" id="S51T194U853">chunk_centers</span>(<span class="var type1" id="S57T2U854">c</span>,<span class="mxinfo " id="T6:U616">1</span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo " id="T3:U617"><span class="mxinfo " id="T2:U618"><span class="var type1" id="S59T2U861">top</span>-<span class="var type1" id="S60T2U862">bottom</span></span> &lt; <span class="mxinfo " id="T2:U621">-<span class="mxinfo " id="T2:U622">900</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line">            <span class="mxinfo " id="T11:U623"><span class="mxinfo " id="T11:U624"><span class="var type1" id="S51T194U868">chunk_centers</span>(<span class="var type1" id="S57T2U869">c</span>,<span class="mxinfo " id="T213:U627">:</span>)</span> = <span class="mxinfo " id="T11:U628">[<span class="mxinfo " id="T2:U629"><span class="var type1" id="S51T194U874">chunk_centers</span>(<span class="var type1" id="S57T2U875">c</span>,<span class="mxinfo " id="T2:U632">1</span>)</span>, <span class="mxinfo " id="T2:U633"><span class="mxinfo " id="T2:U634"><span class="var type1" id="S51T194U879">chunk_centers</span>(<span class="var type1" id="S57T2U880">c</span>,<span class="mxinfo " id="T2:U637">2</span>)</span> - <span class="mxinfo " id="T2:U638"><span class="var type1" id="S6T2U883">radius</span>/<span class="mxinfo " id="T2:U640">2</span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">        <span class="keyword">elseif</span> (<span class="mxinfo " id="T3:U641"><span class="mxinfo " id="T2:U642"><span class="var type1" id="S59T2U889">top</span>-<span class="var type1" id="S60T2U890">bottom</span></span> &lt; <span class="mxinfo " id="T2:U645">-<span class="mxinfo " id="T2:U646">500</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">            <span class="mxinfo " id="T11:U647"><span class="mxinfo " id="T11:U648"><span class="var type1" id="S51T194U896">chunk_centers</span>(<span class="var type1" id="S57T2U897">c</span>,<span class="mxinfo " id="T213:U651">:</span>)</span> = <span class="mxinfo " id="T11:U652">[<span class="mxinfo " id="T2:U653"><span class="var type1" id="S51T194U902">chunk_centers</span>(<span class="var type1" id="S57T2U903">c</span>,<span class="mxinfo " id="T2:U656">1</span>)</span>, <span class="mxinfo " id="T2:U657"><span class="mxinfo " id="T2:U658"><span class="var type1" id="S51T194U907">chunk_centers</span>(<span class="var type1" id="S57T2U908">c</span>,<span class="mxinfo " id="T2:U661">2</span>)</span> - <span class="mxinfo " id="T2:U662"><span class="var type1" id="S6T2U911">radius</span>/<span class="mxinfo " id="T2:U664">5</span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line">        <span class="keyword">elseif</span> (<span class="mxinfo " id="T3:U665"><span class="mxinfo " id="T2:U666"><span class="var type1" id="S59T2U917">top</span>-<span class="var type1" id="S60T2U918">bottom</span></span> &gt; <span class="mxinfo " id="T2:U669">900</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line">            <span class="mxinfo " id="T11:U670"><span class="mxinfo " id="T11:U671"><span class="var type1" id="S51T194U923">chunk_centers</span>(<span class="var type1" id="S57T2U924">c</span>,<span class="mxinfo " id="T213:U674">:</span>)</span> = <span class="mxinfo " id="T11:U675">[<span class="mxinfo " id="T2:U676"><span class="var type1" id="S51T194U929">chunk_centers</span>(<span class="var type1" id="S57T2U930">c</span>,<span class="mxinfo " id="T2:U679">1</span>)</span>, <span class="mxinfo " id="T2:U680"><span class="mxinfo " id="T2:U681"><span class="var type1" id="S51T194U934">chunk_centers</span>(<span class="var type1" id="S57T2U935">c</span>,<span class="mxinfo " id="T2:U684">2</span>)</span> + <span class="mxinfo " id="T2:U685"><span class="var type1" id="S6T2U938">radius</span>/<span class="mxinfo " id="T2:U687">2</span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line">        <span class="keyword">elseif</span> (<span class="mxinfo " id="T3:U688"><span class="var type1" id="S59T2U944">top</span> == <span class="var type1" id="S60T2U945">bottom</span></span> &amp;&amp; <span class="mxinfo " id="T3:U691"><span class="mxinfo " id="T35:U692"><span class="var type1" id="S42T15U948">blank</span>(<span class="mxinfo " id="T2:U694"><span class="var type1" id="S51T194U950">chunk_centers</span>(<span class="var type1" id="S57T2U951">c</span>,<span class="mxinfo " id="T6:U697">2</span>)</span>,<span class="mxinfo " id="T2:U698"><span class="var type1" id="S51T194U954">chunk_centers</span>(<span class="var type1" id="S57T2U955">c</span>,<span class="mxinfo " id="T6:U701">1</span>)</span>)</span> == <span class="mxinfo " id="T2:U702">255</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line">            <span class="mxinfo " id="T11:U703"><span class="mxinfo " id="T11:U704"><span class="var type1" id="S51T194U961">chunk_centers</span>(<span class="var type1" id="S57T2U962">c</span>,<span class="mxinfo " id="T213:U707">:</span>)</span> = <span class="mxinfo " id="T11:U708">[<span class="mxinfo " id="T2:U709"><span class="mxinfo " id="T2:U710"><span class="var type1" id="S51T194U968">chunk_centers</span>(<span class="var type1" id="S57T2U969">c</span>,<span class="mxinfo " id="T2:U713">1</span>)</span>+<span class="mxinfo " id="T2:U714">1</span></span>, <span class="mxinfo " id="T2:U715"><span class="var type1" id="S51T194U973">chunk_centers</span>(<span class="var type1" id="S57T2U974">c</span>,<span class="mxinfo " id="T2:U718">2</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line">            <span class="mxinfo " id="T2:U719"><span class="var type1" id="S59T2U978">top</span> = <span class="mxinfo " id="T2:U721">sum(<span class="mxinfo " id="T211:U722"><span class="var type1" id="S42T15U982">blank</span>(<span class="mxinfo " id="T212:U724"><span class="mxinfo " id="T2:U725"><span class="mxinfo " id="T2:U726"><span class="var type1" id="S51T194U986">chunk_centers</span>(<span class="var type1" id="S57T2U987">c</span>,<span class="mxinfo " id="T6:U729">2</span>)</span>-<span class="mxinfo " id="T2:U730">floor(<span class="var type1" id="S6T2U991">radius</span>)</span></span>:<span class="mxinfo " id="T2:U732"><span class="var type1" id="S51T194U993">chunk_centers</span>(<span class="var type1" id="S57T2U994">c</span>,<span class="mxinfo " id="T6:U735">2</span>)</span></span>,<span class="mxinfo " id="T2:U736"><span class="var type1" id="S51T194U997">chunk_centers</span>(<span class="var type1" id="S57T2U998">c</span>,<span class="mxinfo " id="T6:U739">1</span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line">            <span class="mxinfo " id="T2:U740"><span class="var type1" id="S60T2U1002">bottom</span> = <span class="mxinfo " id="T2:U742">sum(<span class="mxinfo " id="T196:U743"><span class="var type1" id="S42T15U1006">blank</span>(<span class="mxinfo " id="T32:U745"><span class="mxinfo " id="T2:U746"><span class="var type1" id="S51T194U1009">chunk_centers</span>(<span class="var type1" id="S57T2U1010">c</span>,<span class="mxinfo " id="T6:U749">2</span>)</span>:<span class="mxinfo " id="T2:U750"><span class="mxinfo " id="T2:U751"><span class="var type1" id="S51T194U1014">chunk_centers</span>(<span class="var type1" id="S57T2U1015">c</span>,<span class="mxinfo " id="T6:U754">2</span>)</span>+<span class="mxinfo " id="T2:U755">floor(<span class="var type1" id="S6T2U1019">radius</span>)</span></span></span>,<span class="mxinfo " id="T2:U757"><span class="var type1" id="S51T194U1021">chunk_centers</span>(<span class="var type1" id="S57T2U1022">c</span>,<span class="mxinfo " id="T6:U760">1</span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line">            <span class="keyword">if</span> (<span class="mxinfo " id="T3:U761"><span class="mxinfo " id="T2:U762"><span class="var type1" id="S59T2U1029">top</span>-<span class="var type1" id="S60T2U1030">bottom</span></span> &lt; <span class="mxinfo " id="T2:U765">-<span class="mxinfo " id="T2:U766">900</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line">                <span class="mxinfo " id="T11:U767"><span class="mxinfo " id="T11:U768"><span class="var type1" id="S51T194U1036">chunk_centers</span>(<span class="var type1" id="S57T2U1037">c</span>,<span class="mxinfo " id="T213:U771">:</span>)</span> = <span class="mxinfo " id="T11:U772">[<span class="mxinfo " id="T2:U773"><span class="var type1" id="S51T194U1042">chunk_centers</span>(<span class="var type1" id="S57T2U1043">c</span>,<span class="mxinfo " id="T2:U776">1</span>)</span>, <span class="mxinfo " id="T2:U777"><span class="mxinfo " id="T2:U778"><span class="var type1" id="S51T194U1047">chunk_centers</span>(<span class="var type1" id="S57T2U1048">c</span>,<span class="mxinfo " id="T2:U781">2</span>)</span> - <span class="mxinfo " id="T2:U782"><span class="var type1" id="S6T2U1051">radius</span>/<span class="mxinfo " id="T2:U784">2</span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line">            <span class="keyword">elseif</span> (<span class="mxinfo " id="T3:U785"><span class="mxinfo " id="T2:U786"><span class="var type1" id="S59T2U1057">top</span>-<span class="var type1" id="S60T2U1058">bottom</span></span> &gt; <span class="mxinfo " id="T2:U789">900</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line">                <span class="mxinfo " id="T11:U790"><span class="mxinfo " id="T11:U791"><span class="var type1" id="S51T194U1063">chunk_centers</span>(<span class="var type1" id="S57T2U1064">c</span>,<span class="mxinfo " id="T213:U794">:</span>)</span> = <span class="mxinfo " id="T11:U795">[<span class="mxinfo " id="T2:U796"><span class="var type1" id="S51T194U1069">chunk_centers</span>(<span class="var type1" id="S57T2U1070">c</span>,<span class="mxinfo " id="T2:U799">1</span>)</span>, <span class="mxinfo " id="T2:U800"><span class="mxinfo " id="T2:U801"><span class="var type1" id="S51T194U1074">chunk_centers</span>(<span class="var type1" id="S57T2U1075">c</span>,<span class="mxinfo " id="T2:U804">2</span>)</span> + <span class="mxinfo " id="T2:U805"><span class="var type1" id="S6T2U1078">radius</span>/<span class="mxinfo " id="T2:U807">2</span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line">    <span class="mxinfo " id="T194:U808"><span class="var type1" id="S39T194U1082">centers</span> = <span class="mxinfo " id="T194:U810">[<span class="var type1" id="S39T194U1085">centers</span>; <span class="var type1" id="S51T194U1087">chunk_centers</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line">    <span class="mxinfo " id="T203:U813"><span class="mxinfo " id="T203:U814"><span class="var type1" id="S3T15U1091">im</span>(<span class="mxinfo " id="T212:U816"><span class="var type1" id="S45T2U1093">chunk_start</span>:<span class="var type1" id="S46T2U1094">chunk_end</span></span>, <span class="mxinfo " id="T210:U819">:</span>)</span> = <span class="var type1" id="S47T203U1096">im_chunk</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line"><span class="comment">%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line"><span class="comment">% create full staffs and etc.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line"><span class="mxinfo " id="T197:U821"><span class="var type1" id="S61T197U1099">full_staffs</span> = <span class="mxinfo " id="T197:U823">zeros((size(<span class="var type1" id="S21T33U1107">staffs</span>,1) + 3) * (size(<span class="var type1" id="S21T33U1114">staffs</span>,1)/5),1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line"><span class="mxinfo " id="T198:U826"><span class="var type1" id="S62T198U1120">scale</span> = <span class="mxinfo " id="T198:U828">[<span class="string">'A5'</span>;<span class="string">'G5'</span>;<span class="string">'F5'</span>;<span class="string">'E5'</span>;<span class="string">'D5'</span>;<span class="string">'C5'</span>;<span class="string">'B4'</span>;<span class="string">'A4'</span>;<span class="string">'G4'</span>;<span class="string">'F4'</span>;<span class="string">'E4'</span>;<span class="string">'D4'</span>;<span class="string">'C4'</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line"><span class="mxinfo " id="T2:U829"><span class="var type1" id="S40T2U1150">num_stanza</span> = <span class="mxinfo " id="T2:U831">size(<span class="var type1" id="S61T197U1154">full_staffs</span>,1)/size(<span class="var type1" id="S62T198U1158">scale</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line"><span class="mxinfo " id="T200:U834"><span class="var type1" id="S63T200U1162">full_scale</span> = <span class="mxinfo " id="T200:U836">repmat(<span class="var type1" id="S62T198U1165">scale</span>, <span class="var type1" id="S40T2U1166">num_stanza</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S41T2U1170">stanza</span>=<span class="mxinfo " id="T2:U840">1</span>:<span class="var type1" id="S40T2U1173">num_stanza</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line">    <span class="mxinfo " id="T2:U842"><span class="var type1" id="S65T2U1176">full_start</span> = <span class="mxinfo " id="T2:U844"><span class="mxinfo " id="T2:U845">1</span> + (<span class="mxinfo " id="T2:U846"><span class="mxinfo " id="T2:U847">size(<span class="var type1" id="S62T198U1183">scale</span>,1)</span> * (<span class="mxinfo " id="T2:U849"><span class="var type1" id="S41T2U1187">stanza</span>-<span class="mxinfo " id="T2:U851">1</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line">    <span class="mxinfo " id="T2:U852"><span class="var type1" id="S66T2U1191">staff_start</span> = <span class="mxinfo " id="T2:U854"><span class="mxinfo " id="T2:U855">1</span> + (<span class="mxinfo " id="T2:U856"><span class="mxinfo " id="T2:U857">size(<span class="var type1" id="S21T33U1199">staffs</span>,1)/<span class="var type1" id="S40T2U1201">num_stanza</span></span> * (<span class="mxinfo " id="T2:U860"><span class="var type1" id="S41T2U1204">stanza</span>-<span class="mxinfo " id="T2:U862">1</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line">    <span class="mxinfo " id="T2:U863"><span class="mxinfo " id="T2:U864"><span class="var type1" id="S61T197U1209">full_staffs</span>(<span class="var type1" id="S65T2U1210">full_start</span>)</span> = <span class="mxinfo " id="T2:U867"><span class="mxinfo " id="T2:U868"><span class="var type1" id="S21T33U1213">staffs</span>(<span class="var type1" id="S66T2U1214">staff_start</span>)</span>-<span class="var type1" id="S37T2U1215">avg_staff_height</span></span></span>; <span class="comment">%A5</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line">    <span class="mxinfo " id="T2:U872"><span class="mxinfo " id="T2:U873"><span class="var type1" id="S61T197U1219">full_staffs</span>(<span class="mxinfo " id="T2:U875"><span class="var type1" id="S65T2U1221">full_start</span> + <span class="mxinfo " id="T2:U877">1</span></span>)</span> = <span class="mxinfo " id="T2:U878"><span class="mxinfo " id="T2:U879"><span class="var type1" id="S21T33U1225">staffs</span>(<span class="var type1" id="S66T2U1226">staff_start</span>)</span>-<span class="mxinfo " id="T2:U882"><span class="var type1" id="S37T2U1228">avg_staff_height</span>/<span class="mxinfo " id="T2:U884">2</span></span></span></span>; <span class="comment">%G5</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line">    <span class="mxinfo " id="T2:U885"><span class="var type1" id="S67T2U1232">l</span> = <span class="var type1" id="S66T2U1233">staff_start</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S68T2U1236">p</span> = <span class="mxinfo " id="T2:U889"><span class="var type1" id="S65T2U1239">full_start</span> + <span class="mxinfo " id="T2:U891">2</span></span>:<span class="mxinfo " id="T2:U892"><span class="var type1" id="S65T2U1242">full_start</span> + <span class="mxinfo " id="T2:U894">10</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T2:U895">mod(<span class="mxinfo " id="T2:U896"><span class="mxinfo " id="T2:U897"><span class="var type1" id="S68T2U1250">p</span> + <span class="var type1" id="S41T2U1251">stanza</span></span>-<span class="mxinfo " id="T2:U900">1</span></span>,<span class="mxinfo " id="T2:U901">2</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line">            <span class="mxinfo " id="T2:U902"><span class="mxinfo " id="T2:U903"><span class="var type1" id="S61T197U1257">full_staffs</span>(<span class="var type1" id="S68T2U1258">p</span>)</span> = <span class="mxinfo " id="T2:U906"><span class="var type1" id="S21T33U1260">staffs</span>(<span class="var type1" id="S67T2U1261">l</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line">            <span class="mxinfo " id="T2:U909"><span class="mxinfo " id="T2:U910"><span class="var type1" id="S61T197U1266">full_staffs</span>(<span class="var type1" id="S68T2U1267">p</span>)</span> = <span class="mxinfo " id="T2:U913"><span class="mxinfo " id="T2:U914"><span class="var type1" id="S21T33U1270">staffs</span>(<span class="var type1" id="S67T2U1271">l</span>)</span> + <span class="mxinfo " id="T2:U917"><span class="var type1" id="S37T2U1273">avg_staff_height</span>/<span class="mxinfo " id="T2:U919">2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line">            <span class="mxinfo " id="T2:U920"><span class="var type1" id="S67T2U1277">l</span> = <span class="mxinfo " id="T2:U922"><span class="var type1" id="S67T2U1279">l</span> + <span class="mxinfo " id="T2:U924">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line">    <span class="mxinfo " id="T2:U925"><span class="mxinfo " id="T2:U926"><span class="var type1" id="S61T197U1284">full_staffs</span>(<span class="mxinfo " id="T2:U928"><span class="var type1" id="S65T2U1286">full_start</span> + <span class="mxinfo " id="T2:U930">11</span></span>)</span> = <span class="mxinfo " id="T2:U931"><span class="mxinfo " id="T2:U932"><span class="var type1" id="S21T33U1290">staffs</span>(<span class="mxinfo " id="T2:U934"><span class="var type1" id="S66T2U1292">staff_start</span> + <span class="mxinfo " id="T2:U936">4</span></span>)</span>+<span class="mxinfo " id="T2:U937"><span class="var type1" id="S37T2U1295">avg_staff_height</span>/<span class="mxinfo " id="T2:U939">2</span></span></span></span>; <span class="comment">%D4</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line">    <span class="mxinfo " id="T2:U940"><span class="mxinfo " id="T2:U941"><span class="var type1" id="S61T197U1300">full_staffs</span>(<span class="mxinfo " id="T2:U943"><span class="var type1" id="S65T2U1302">full_start</span> + <span class="mxinfo " id="T2:U945">12</span></span>)</span> = <span class="mxinfo " id="T2:U946"><span class="mxinfo " id="T2:U947"><span class="var type1" id="S21T33U1306">staffs</span>(<span class="mxinfo " id="T2:U949"><span class="var type1" id="S66T2U1308">staff_start</span> + <span class="mxinfo " id="T2:U951">4</span></span>)</span>+<span class="var type1" id="S37T2U1310">avg_staff_height</span></span></span>; <span class="comment">%C4</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line"><span class="comment">%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line"><span class="comment">% get those letters</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line"><span class="mxinfo " id="T201:U953"><span class="var type1" id="S2T201U1313">notes</span> = <span class="mxinfo " id="T201:U955">char(<span class="mxinfo " id="T194:U956"><span class="mxinfo " id="T32:U957">ones(<span class="mxinfo " id="T2:U958">size(<span class="var type1" id="S39T194U1321">centers</span>,1)</span>,1)</span> * <span class="string">'00'</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S8T2U1327">i</span>=<span class="mxinfo " id="T2:U961">1</span>:<span class="mxinfo " id="T2:U962">size(<span class="var type1" id="S39T194U1332">centers</span>,1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line">    <span class="mxinfo " id="T197:U964"><span class="var type1" id="S70T197U1336">diff</span> = <span class="mxinfo " id="T197:U966"><span class="var type1" id="S61T197U1338">full_staffs</span> - <span class="mxinfo " id="T2:U968"><span class="var type1" id="S39T194U1340">centers</span>(<span class="var type1" id="S8T2U1341">i</span>,<span class="mxinfo " id="T2:U971">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line">    [<span class="mxinfo " id="T2:U972"><span class="mxinfo " id="T2:U973">~</span></span>, <span class="mxinfo " id="T2:U974"><span class="var type1" id="S71T2U1347">min_in</span></span>] = min(<span class="mxinfo " id="T197:U976">abs(<span class="var type1" id="S70T197U1352">diff</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line">    <span class="mxinfo " id="T45:U978"><span class="mxinfo " id="T45:U979"><span class="var type1" id="S2T201U1356">notes</span>(<span class="var type1" id="S8T2U1357">i</span>,<span class="mxinfo " id="T213:U982">:</span>)</span> = <span class="mxinfo " id="T45:U983"><span class="var type1" id="S63T200U1360">full_scale</span>(<span class="var type1" id="S71T2U1361">min_in</span>,<span class="mxinfo " id="T213:U986">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line"><span class="comment">%     closest_to(centers(i,2), full_staffs, full_scale, avg_staff_height); </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
